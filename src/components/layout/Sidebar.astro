---
import type { UserRole } from '../../types/database';
import {
  Home,
  FileText,
  Upload,
  Clock,
  Building2,
  Users,
  Briefcase,
  TrendingUp,
  Settings,
  LogOut
} from 'lucide-react';

interface NavItem {
  href: string;
  label: string;
  icon: typeof Home;
}

interface Props {
  role: UserRole;
  currentPath: string;
}

const { role, currentPath } = Astro.props;

const borrowerNav: NavItem[] = [
  { href: '/dashboard', label: 'Dashboard', icon: Home },
  { href: '/application', label: 'Application', icon: FileText },
  { href: '/application/upload', label: 'Documents', icon: Upload },
  { href: '/application/status', label: 'Status', icon: Clock },
];

const investorNav: NavItem[] = [
  { href: '/investor/dashboard', label: 'Dashboard', icon: Home },
  { href: '/deals', label: 'Deal Room', icon: Briefcase },
  { href: '/investor/interests', label: 'My Interests', icon: TrendingUp },
];

const adminNav: NavItem[] = [
  { href: '/admin', label: 'Dashboard', icon: Home },
  { href: '/admin/applications', label: 'Applications', icon: FileText },
  { href: '/admin/investors', label: 'Investors', icon: Users },
  { href: '/admin/deals', label: 'Deals', icon: Briefcase },
];

const navItems = role === 'borrower'
  ? borrowerNav
  : role === 'investor'
    ? investorNav
    : adminNav;

function isActive(href: string): boolean {
  if (href === '/dashboard' || href === '/investor/dashboard' || href === '/admin') {
    return currentPath === href;
  }
  return currentPath.startsWith(href);
}
---

<aside class="w-64 bg-white border-r border-light min-h-screen flex flex-col">
  <!-- Logo -->
  <div class="h-16 flex items-center px-6 border-b border-light">
    <a href="/" class="flex items-center gap-2 no-underline">
      <span class="text-lg font-bold text-primary">PrimeBridge</span>
    </a>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 py-6">
    <ul class="space-y-1 px-3">
      {navItems.map((item) => {
        const Icon = item.icon;
        const active = isActive(item.href);
        return (
          <li>
            <a
              href={item.href}
              class:list={[
                'flex items-center gap-3 px-3 py-2.5 rounded-md text-base font-medium no-underline transition-colors',
                active
                  ? 'bg-primary/10 text-primary'
                  : 'text-dark hover:bg-lightest hover:text-darkest'
              ]}
            >
              <Icon className="h-5 w-5" />
              {item.label}
            </a>
          </li>
        );
      })}
    </ul>
  </nav>

  <!-- Bottom section -->
  <div class="p-3 border-t border-light">
    <form action="/api/auth/logout" method="POST">
      <button
        type="submit"
        class="flex items-center gap-3 px-3 py-2.5 rounded-md text-base font-medium text-dark hover:bg-lightest hover:text-darkest w-full transition-colors"
      >
        <LogOut className="h-5 w-5" />
        Log out
      </button>
    </form>
  </div>
</aside>
